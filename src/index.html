<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- <meta http-equiv="Strict-Transport-Security" content="max-age=31536000;"> -->
  <!-- <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" /> -->
  <!-- <meta http-equiv="Content-Security-Policy" content=" default-src 'self' *.googletagmanager.com/ *.google-analytics.com/ login.microsoftonline.com/ *.b2clogin.com/ *.azurewebsites.net/ *.myshopify.com/ *.blob.core.windows.net/ api.mapbox.com/ events.mapbox.com/ *.pinkerton.com/ iam.twilio.com wss://tsock.us1.twilio.com flex-api.twilio.com cdnjs.cloudflare.com/ assets.flex.twilio.com/ google.com/ cdn.jsdelivr.net/ code.jquery.com/ www.gstatic.com/ fonts.googleapis.com/ fonts.gstatic.com/ pay.google.com/ checkout.shopify.com/ shop.app/ *.myshopify.com/ paypal.com/ c.paypal.com cdn.shopify.com cdn.shopifycdn.net/ https://www.google.com/recaptcha/ blob: data: 'unsafe-inline' 'unsafe-eval'; child-src 'self' *.b2clogin.com google.com *.google.com *.shopify.com/ shop.app/ *.myshopify.com/ paypal.com/ blob:;"/>
  <meta http-equiv="Referrer-Policy" content="no-referrer" />
  <meta http-equiv="Permissions-Policy" content="accelerometer=(self), camera=(self), geolocation=(self), gyroscope=(self), magnetometer=(self), microphone=(self)" /> -->
  <title>Pinkerton Risk Portal</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/css/flaticon.css" rel="stylesheet" />
  <link href="assets/css/ionicons.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
  <link rel="stylesheet" href="./assets/css/mapbox-gl-geocoder.css" type="text/css"> 
  <script src="https://www.google.com/recaptcha/enterprise.js" async defer></script>
  <link rel="stylesheet" href="./assets/css/mapbox-gl-geocoder.css" type="text/css">   
  <script src="https://assets.flex.twilio.com/releases/flex-webchat-ui/2.9.0/twilio-flex-webchat.min.js" integrity="sha512-gfk5re40mGDic7co5dfTc4ZVtL2sQ0xFrzsJsMg1QbDisA3UyQB5Crd7Yyk7AOeGvdX1pltln7pq/aADzTJD4g==" crossorigin></script>
  <style>
  .Twilio-MainContainer{
    border-radius:10px;
  }
  </style>

</head>
<body>  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E11K8MTQX2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E11K8MTQX2');
  
  const backgroundPinkerton = "#232323";
  const brandTextColor = "#ffffff";
  const entryImg = '<img src="/assets/images/chatBotTopLogo.png" />'; 
  const brandMessageBubbleColors = (bgColor) => ({
      Bubble: {
          background: bgColor,
          color: brandTextColor
      },
      Avatar: {
          background: bgColor,
          color: brandTextColor
      },
      Header: {
          color: brandTextColor
      }
  });
  const appConfig = {
      accountSid:"AC151a6cc7c6294008235dce9d566b054d",
      flexFlowSid:"FO9a4a5289ad82e7c091c6e88101721edc",
      
      componentProps: {
        MainHeader: {
          titleText: "Customer Support",
          imageUrl: "/assets/images/chatBotTopLogo.png"
        },
        EntryPoint:{
          tagline: " "
        },
        MessagingCanvas: {
          avatarCallback: function(){return "/assets/images/pnkChatProfileIcon.png";},
          memberDisplayOptions: {
            yourFriendlyNameOverride: false,
            theirFriendlyNameOverride: false,
            yourDefaultName: 'You',
            theirDefaultName: 'Pinkerton Portal Support'
          }
        },
        MessageInput:{
          sendButtonAriaProps:{
            testprop:"yes"
          }
        }
      },
      colorTheme: {
        baseName: "Pinkerton",
        colors: {
            base0: "#000000",
            base1: "#232323",
            base2: "#232323",
            base3: "#d4d4d4",
            base4: "#232323",
            base5: "#efefef",
            base6: "#ffffff",
            darkTextColor: "#ffffff",
            buttonHoverColor: "#ffffff",
            tabSelectedColor: "#232323",
            connectingColor: "#ff9800",
            disconnectedColor: "#DC3A25"
        },
        overrides: {
          MainHeader: {
              Container: {
                background: "#DC3A25"
              }
            },
          MainContainer: {
            startEngagementOnInit: true
          },
          MessagingCanvas: {
            messageStyle: "Minimal"
          },
          EntryPoint: {
              Container: {
                backgroundImage: "url('/assets/images/entryPointChat.png') !important",
                backgroundColor: "#FFF",
                backgroundRepeat: "no-repeat",
                backgroundPosition: "center",
                backgroundSize: "25px 25px",
                width: "50px",
                height: "50px",
                cursor: "pointer",
                "&:hover": {
                  backgroundImage: "url('/assets/images/chatBotTopLogo.png')",
                  backgroundColor: "#DC3A25",
                  backgroundBlendMode:"none"
                }
              }
          },
          ButtonThemeProps:{
            lightHover:false
          },
          Chat: {
            MessageListItem: {
                FromOthers: brandMessageBubbleColors(backgroundPinkerton),
                FromMe: brandMessageBubbleColors(backgroundPinkerton)
              }
          },
        }
    }
  };


  Twilio.FlexWebChat.createWebChat(appConfig).then(webchat => {
    const { manager } = webchat;
    let username = localStorage.getItem('LoggedInName') == null ? 'User' : localStorage.getItem('LoggedInName'); 
      manager.strings.PredefinedChatMessageBody = "Hi  " + username + "! Welcome to the Pinkerton Risk Portal customer service chat box. Is there anything I can help you with today?";
      manager.strings.PredefinedChatMessageAuthorName = "Pinkerton Portal Support";
    
      // Twilio.FlexWebChat.Actions.on("beforeToggleChatVisibility", () => {
      //   var calCount=0;
      //   $("#twilio-customer-frame .Twilio-MessagingCanvas .Twilio-MessageList .Twilio-MessageBubble-Body").each(function(){calCount+= calCount+1;});
      //   if(calCount != 0){
      //   alert("count is " + calCount);
      //   }
      // });
      // Twilio.FlexWebChat.Actions.on("afterToggleChatVisibility", () => {
      //   var calCount=0;
      //   $("#twilio-customer-frame .Twilio-MessagingCanvas .Twilio-MessageList .Twilio-MessageBubble-Body").each(function(){calCount+= calCount+1;});
      //   if(calCount != 0){
      //   //alert("count is " + calCount);
      //   }
      // });
    // Render WebChat
    webchat.init();
   



  });
  
</script>
  <app-root></app-root>
  
</body>
</html>
